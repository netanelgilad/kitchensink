<!-- Generated by SpecStory -->

# Update service dependencies for profile updates (2025-06-07 10:08:19)

_**User**_

client side services can depend on one another. the services factory function accepts a `getService` function it can use to get other serivces that the service depends on.  you use `getService` and provider the service deifnition you want ot depend on.
so we'll want to update project.mdc @project.mdc with this knowledger.
now I want @profile-update-service.ts to dpend on @current-member-service.ts and use it's updateMember function when it want to udpate the profile, it shouldn't use the relative api endpoint anymore. This way it would udpate the client side state of current memeber right away.

---

_**Assistant**_



---

I'll help you update the documentation and modify the profile-update-service to depend on the current-member-service. Let me start by finding and updating the project documentation, then modifying the service.

---

<details>
            <summary>Searched codebase "project.mdc" • **3** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

Could not find file '@project.mdc' in the workspace.

---

Read file: .cursor/rules/project.mdc

---

Now I need to check if there's any existing documentation about the client-side services architecture. Let me search for it.

---

<details>
            <summary>Searched codebase "client-side-services" • **4** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

Read file: .cursor/rules/client-side-services-and-headless-components.mdc

---

Now let me update the project documentation with the service dependency information:

---

```diff
  so use `as any` when passing in the initial value and use `: Signal<TheType>` to 
  set the right type for the signal.
+ ```
+ </note>
+ 
+ ## Service Dependencies
+ 
+ Client-side services can depend on other services using the `getService` function provided in the service factory. This allows services to compose functionality and maintain consistency across related services.
+ 
+ ### How Service Dependencies Work
+ 
+ When implementing a service, the factory function receives a `getService` function that can be used to get instances of other services:
+ 
+ ```tsx
+ export const ProfileUpdateService = implementService.withConfig<{
+   memberId: string;
+   initialData?: Partial<ProfileFormData>;
+ }>()(ProfileUpdateServiceDefinition, ({ getService, config }) => {
+   // Get other services this service depends on
+   const signalsService = getService(SignalsServiceDefinition);
+   const currentMemberService = getService(CurrentMemberServiceDefinition);
+   
+   // Use the dependent services in your service logic
+   const updateProfile = async () => {
+     // Use currentMemberService.updateMember instead of direct API calls
+     await currentMemberService.updateMember(memberUpdate);
+   };
+   
+   return {
+     // Service API
+   };
+ });
+ ```
+ 
+ ### Benefits of Service Dependencies
+ 
+ 1. **Consistency**: When one service updates data, dependent services automatically reflect the changes
+ 2. **Reusability**: Services can reuse logic from other services instead of duplicating code
+ 3. **Maintainability**: Changes to core service logic automatically propagate to dependent services
+ 4. **Client-side State Sync**: Updates through one service immediately update the client-side state in related services
+ 
+ ### Example: ProfileUpdate Depending on CurrentMember
+ 
+ ```tsx
+ // ProfileUpdateService depends on CurrentMemberService
+ const currentMemberService = getService(CurrentMemberServiceDefinition);
+ 
+ const updateProfile = async () => {
+   const formData = formData.get();
+   
+   // Convert form data to member update format
+   const memberUpdate = {
+     contact: {
+       firstName: formData.firstName,
+       lastName: formData.lastName,
+       // ... other fields
+     },
+     profile: {
+       nickname: formData.nickname,
+       title: formData.profileTitle
+     }
+   };
+   
+   // Use the currentMemberService to update, which will:
+   // 1. Make the API call
+   // 2. Update the client-side state immediately
+   await currentMemberService.updateMember(memberUpdate);
+ };
+ ```
+ 
+ This way, when the profile is updated, the current member state is immediately updated on the client side, and any UI components using the CurrentMember headless components will reactively update.
```

---

There was a formatting issue. Let me fix that:

---



---

Now let me update the profile-update-service.ts to depend on the current-member-service and use its updateMember function:

---

```diff
  import { SignalsServiceDefinition } from "@wix/services-definitions/core-services/signals";
  import type { Signal } from "../Signal";
+ import { CurrentMemberServiceDefinition } from "./current-member-service";
  
  export interface ProfileFormData {
```

```diff
  }>()(ProfileUpdateServiceDefinition, ({ getService, config }) => {
    const signalsService = getService(SignalsServiceDefinition);
+   const currentMemberService = getService(CurrentMemberServiceDefinition);
  
    const defaultFormData: ProfileFormData = {
```

```diff
  
        const data = formData.get();
-       const formDataObj = new FormData();
+       
+       // Convert form data to member update format
+       const memberUpdate: any = {
+         contact: {},
+         profile: {},
+       };
  
-       // Add all form fields
-       formDataObj.append("memberId", config.memberId);
-       Object.entries(data).forEach(([key, value]) => {
-         if (value) {
-           formDataObj.append(key, value);
-         }
-       });
- 
-       const response = await fetch("/api/update-profile", {
-         method: "POST",
-         body: formDataObj,
-       });
- 
-       if (response.ok) {
-         updateState.set({
-           type: "success",
-           message: "Profile updated successfully!",
-         });
-         // Auto-reload after success
-         setTimeout(() => {
-           window.location.reload();
-         }, 1500);
-       } else {
-         const error = await response.text();
-         updateState.set({
-           type: "error",
-           message: `Update failed: ${error}`,
-         });
-       }
+       // Map personal information
+       if (data.firstName) memberUpdate.contact.firstName = data.firstName;
+       if (data.lastName) memberUpdate.contact.lastName = data.lastName;
+       if (data.birthdate) memberUpdate.contact.birthdate = data.birthdate;
+       
+       // Map professional information
+       if (data.company) memberUpdate.contact.company = data.company;
+       if (data.jobTitle) memberUpdate.contact.jobTitle = data.jobTitle;
+       
+       // Map contact information
+       if (data.emails) {
+         memberUpdate.contact.emails = data.emails.split(',').map((email: string) => email.trim()).filter(Boolean);
+       }
+       if (data.phones) {
+         memberUpdate.contact.phones = data.phones.split(',').map((phone: string) => phone.trim()).filter(Boolean);
+       }
+       
+       // Map address information
+       if (data.addressLine || data.addressLine2 || data.city || data.subdivision || data.postalCode || data.country) {
+         memberUpdate.contact.addresses = [{
+           ...(data.addressLine && { addressLine: data.addressLine }),
+           ...(data.addressLine2 && { addressLine2: data.addressLine2 }),
+           ...(data.city && { city: data.city }),
+           ...(data.subdivision && { subdivision: data.subdivision }),
+           ...(data.postalCode && { postalCode: data.postalCode }),
+           ...(data.country && { country: data.country }),
+         }];
+       }
+       
+       // Map profile information
+       if (data.nickname) memberUpdate.profile.nickname = data.nickname;
+       if (data.profileTitle) memberUpdate.profile.title = data.profileTitle;
+       
+       // Map privacy status
+       if (data.privacyStatus) memberUpdate.privacyStatus = data.privacyStatus;
+ 
+       // Clean up empty objects
+       if (Object.keys(memberUpdate.contact).length === 0) {
+         delete memberUpdate.contact;
+       }
+       if (Object.keys(memberUpdate.profile).length === 0) {
+         delete memberUpdate.profile;
+       }
+ 
+       // Use the currentMemberService to update, which will update both server and client state
+       await currentMemberService.updateMember(memberUpdate);
+ 
+       updateState.set({
+         type: "success",
+         message: "Profile updated successfully!",
+       });
+       
+       // Auto-reload after success to ensure UI is fully synced
+       setTimeout(() => {
+         window.location.reload();
+       }, 1500);
      } catch (error) {
        updateState.set({
```

---

Perfect! I've successfully updated both the documentation and the profile-update-service to implement service dependencies. Here's what I've done:

## Documentation Updates

1. **Added Service Dependencies Section** to `.cursor/rules/client-side-services-and-headless-components.mdc`:
   - Explained how services can depend on each other using the `getService` function
   - Listed the benefits: consistency, reusability, maintainability, and client-side state sync
   - Provided a concrete example of ProfileUpdate depending on CurrentMember

## Profile Update Service Changes

2. **Modified `src/headless/members/profile-update-service.ts`**:
   - **Added dependency**: Imported `CurrentMemberServiceDefinition` and used `getService` to get the current member service
   - **Replaced API endpoint**: Removed the direct fetch call to `/api/update-profile`
   - **Added data mapping**: Converted the form data to the proper member update format that the Wix members API expects
   - **Used service method**: Now calls `currentMemberService.updateMember(memberUpdate)` instead of making direct API calls

## Key Benefits

The refactored service now:

1. **Updates client-side state immediately**: When the profile is updated, the current member state in the client is updated right away through the CurrentMemberService
2. **Maintains consistency**: Any UI components using CurrentMember headless components will reactively update when the profile changes
3. **Reuses existing logic**: Leverages the updateMember function from CurrentMemberService instead of duplicating API call logic
4. **Better separation of concerns**: The ProfileUpdateService focuses on form management while delegating member updates to the specialized CurrentMemberService

The profile update will now immediately reflect changes in the client-side state, making the UI more responsive and consistent across all components that depend on the current member data.

---

_**User**_

now since the profile update service depends on the current member serivce, they have to be used in the same ServicesManager in order to share state. so when rendering the current memeber service at the top ofhte memebts page, also add the profule update services there, and no longer render a services manager inside the dialog component itself.
also be sure to udpate tdocs to mention this rule, that in order for services taht depend on each other to share state, tehy have to be in the same services manager

---

_**Assistant**_



---

I'll help you update the members page to include both services in the same ServicesManager and update the documentation. Let me first examine the current implementation.

---

<details>
            <summary>Searched codebase "members page" • **10** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

Read file: src/react-pages/members/index.tsx

---

Read file: src/react-pages/members/index.tsx

---

Read file: src/react-pages/members/index.tsx

---

Now let me look at the UpdateProfileDialog to see how it currently sets up its own ServicesManager:

---

Read file: src/components/UpdateProfileDialog.tsx

---

Now let me look at the Astro page to see how the currentMemberServiceConfig is passed:

---

Read file: src/pages/members/index.astro

---

Now I'll modify the necessary files. First, let me update the members page to include both services in the same ServicesManager:

---

```diff
    CurrentMemberService,
  } from "../../headless/members/current-member-service";
+ import {
+   ProfileUpdateServiceDefinition,
+   ProfileUpdateService,
+ } from "../../headless/members/profile-update-service";
  import { CurrentMemberProfile } from "../../headless/members/CurrentMemberProfile";
  
```

```diff
    error?: string | null;
    currentMemberServiceConfig?: any;
+   profileUpdateServiceConfig?: any;
  }
  
```

```diff
    error,
    currentMemberServiceConfig,
+   profileUpdateServiceConfig,
  }: MembersPageProps) {
    const [showUpdateDialog, setShowUpdateDialog] = useState(false);
```

```diff
    }, [showErrorMessage]);
  
-   return (
-     <ServicesManagerProvider
-       servicesManager={createServicesManager(
-         createServicesMap().addService(
-           CurrentMemberServiceDefinition,
-           CurrentMemberService,
-           currentMemberServiceConfig
-         )
-       )}
-     >
+   // Create services manager with both services
+   const servicesManager = createServicesManager(
+     createServicesMap()
+       .addService(
+         CurrentMemberServiceDefinition,
+         CurrentMemberService,
+         currentMemberServiceConfig
+       )
+       .addService(
+         ProfileUpdateServiceDefinition,
+         ProfileUpdateService,
+         profileUpdateServiceConfig
+       )
+   );
+ 
+   return (
+     <ServicesManagerProvider servicesManager={servicesManager}>
        <KitchensinkLayout>
          {/* Success/Error Messages */}
```

---

Now I need to update the Astro page to load the profile update service config:

---

```diff
  import { MembersPage } from "../../react-pages/members/index";
  import { loadCurrentMemberServiceConfig } from "../../headless/members/current-member-service";
+ import { loadProfileUpdateServiceConfig } from "../../headless/members/profile-update-service";
  
  // Server-side logic
  const userIsLoggedIn = isLoggedIn();
  let member;
  let currentMemberServiceConfig;
+ let profileUpdateServiceConfig;
  
  if (userIsLoggedIn) {
```

```diff
    ).member;
  
-   // Load service configuration for headless components
+   // Load service configurations for headless components
    if (member) {
      currentMemberServiceConfig = await loadCurrentMemberServiceConfig();
+     profileUpdateServiceConfig = await loadProfileUpdateServiceConfig(member._id, member);
    }
  }
```

```diff
      error={error}
      currentMemberServiceConfig={currentMemberServiceConfig}
+     profileUpdateServiceConfig={profileUpdateServiceConfig}
      slot="body"
    />
```

---

I need to fix the linter error by checking that member._id exists:

---



---



---

Now I need to remove the ServicesManagerProvider from the UpdateProfileDialog component since the services are now managed at the page level:

---

```diff
- import {
-   createServicesManager,
-   createServicesMap,
- } from "@wix/services-manager";
- import { ServicesManagerProvider } from "@wix/services-manager-react";
- import {
-   ProfileUpdateService,
-   ProfileUpdateServiceDefinition,
- } from "../headless/members/profile-update-service";
  import {
    ProfileFormField,
```

```diff
  
    return (
-     <ServicesManagerProvider
-       servicesManager={createServicesManager(
-         createServicesMap().addService(
-           ProfileUpdateServiceDefinition,
-           ProfileUpdateService,
-           {
-             memberId: member?._id,
-             initialData: member
-               ? {
-                   firstName: member.contact?.firstName || "",
-                   lastName: member.contact?.lastName || "",
-                   nickname: member.profile?.nickname || "",
-                   profileTitle: member.profile?.title || "",
-                   birthdate: member.contact?.birthdate || "",
-                   privacyStatus: member.privacyStatus || "PUBLIC",
-                   company: member.contact?.company || "",
-                   jobTitle: member.contact?.jobTitle || "",
-                   emails: member.contact?.emails?.join(", ") || "",
-                   phones: member.contact?.phones?.join(", ") || "",
-                   addressLine:
-                     member.contact?.addresses?.[0]?.addressLine || "",
-                   addressLine2:
-                     member.contact?.addresses?.[0]?.addressLine2 || "",
-                   city: member.contact?.addresses?.[0]?.city || "",
-                   subdivision:
-                     member.contact?.addresses?.[0]?.subdivision || "",
-                   postalCode: member.contact?.addresses?.[0]?.postalCode || "",
-                   country: member.contact?.addresses?.[0]?.country || "",
-                 }
-               : undefined,
-           }
-         )
-       )}
-     >
-       <div
-         className="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm"
-         onClick={(e) => e.target === e.currentTarget && onClose()}
-       >
-         {/* Dialog Container */}
-         <div className="flex items-center justify-center min-h-screen p-4">
-           <div className="bg-white/10 backdrop-blur-lg rounded-3xl shadow-2xl border border-white/20 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
-             {/* Dialog Header */}
-             <div className="flex items-center justify-between p-6 border-b border-white/20">
-               <h2 className="text-2xl font-bold text-white flex items-center gap-3">
-                 <svg
-                   className="w-7 h-7"
-                   fill="none"
-                   viewBox="0 0 24 24"
-                   stroke="currentColor"
-                 >
-                   <path
-                     strokeLinecap="round"
-                     strokeLinejoin="round"
-                     strokeWidth="2"
-                     d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"
-                   />
-                 </svg>
-                 Update Profile
-               </h2>
-               <button
-                 onClick={onClose}
-                 className="text-white/60 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg"
-               >
-                 <svg
-                   className="w-6 h-6"
-                   fill="none"
-                   viewBox="0 0 24 24"
-                   stroke="currentColor"
-                 >
-                   <path
-                     strokeLinecap="round"
-                     strokeLinejoin="round"
-                     strokeWidth="2"
-                     d="M6 18L18 6M6 6l12 12"
-                   />
-                 </svg>
-               </button>
-             </div>
+     <div
+       className="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm"
+       onClick={(e) => e.target === e.currentTarget && onClose()}
+     >
+       {/* Dialog Container */}
+       <div className="flex items-center justify-center min-h-screen p-4">
+         <div className="bg-white/10 backdrop-blur-lg rounded-3xl shadow-2xl border border-white/20 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
+           {/* Dialog Header */}
+           <div className="flex items-center justify-between p-6 border-b border-white/20">
+             <h2 className="text-2xl font-bold text-white flex items-center gap-3">
+               <svg
+                 className="w-7 h-7"
+                 fill="none"
+                 viewBox="0 0 24 24"
+                 stroke="currentColor"
+               >
+                 <path
+                   strokeLinecap="round"
+                   strokeLinejoin="round"
+                   strokeWidth="2"
+                   d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"
+                 />
+               </svg>
+               Update Profile
+             </h2>
+             <button
+               onClick={onClose}
+               className="text-white/60 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg"
+             >
+               <svg
+                 className="w-6 h-6"
+                 fill="none"
+                 viewBox="0 0 24 24"
+                 stroke="currentColor"
+               >
+                 <path
+                   strokeLinecap="round"
+                   strokeLinejoin="round"
+                   strokeWidth="2"
+                   d="M6 18L18 6M6 6l12 12"
+                 />
+               </svg>
+             </button>
+           </div>
  
-             {/* Dialog Content */}
-             <div className="p-6">
-               {/* Personal Information Section */}
-               <div className="bg-white/5 rounded-xl p-6 backdrop-blur-sm mb-6">
-                 <h3 className="text-xl font-semibold text-white mb-4 flex items-center gap-3">
-                   <svg
-                     className="w-6 h-6"
-                     fill="none"
-                     viewBox="0 0 24 24"
-                     stroke="currentColor"
-                   >
-                     <path
-                       strokeLinecap="round"
-                       strokeLinejoin="round"
-                       strokeWidth="2"
-                       d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
-                     />
-                   </svg>
-                   Personal Information
-                 </h3>
-                 <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
-                   <ProfileFormField field="firstName">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           First Name
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="Enter your first name"
-                         />
-                       </div>
-                     )}
-                   </ProfileFormField>
+           {/* Dialog Content */}
+           <div className="p-6">
+             {/* Personal Information Section */}
+             <div className="bg-white/5 rounded-xl p-6 backdrop-blur-sm mb-6">
+               <h3 className="text-xl font-semibold text-white mb-4 flex items-center gap-3">
+                 <svg
+                   className="w-6 h-6"
+                   fill="none"
+                   viewBox="0 0 24 24"
+                   stroke="currentColor"
+                 >
+                   <path
+                     strokeLinecap="round"
+                     strokeLinejoin="round"
+                     strokeWidth="2"
+                     d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
+                   />
+                 </svg>
+                 Personal Information
+               </h3>
+               <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
+                 <ProfileFormField field="firstName">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         First Name
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="Enter your first name"
+                       />
+                     </div>
+                   )}
+                 </ProfileFormField>
  
-                   <ProfileFormField field="lastName">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           Last Name
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="Enter your last name"
-                         />
-                       </div>
-                     )}
-                   </ProfileFormField>
+                 <ProfileFormField field="lastName">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         Last Name
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="Enter your last name"
+                       />
+                     </div>
+                   )}
+                 </ProfileFormField>
  
-                   <ProfileFormField field="nickname">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           Nickname
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="Your display name"
-                         />
-                       </div>
-                     )}
-                   </ProfileFormField>
+                 <ProfileFormField field="nickname">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         Nickname
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="Your display name"
+                       />
+                     </div>
+                   )}
+                 </ProfileFormField>
  
-                   <ProfileFormField field="profileTitle">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           Profile Title
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="Your title or role"
-                         />
-                       </div>
-                     )}
-                   </ProfileFormField>
+                 <ProfileFormField field="profileTitle">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         Profile Title
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="Your title or role"
+                       />
+                     </div>
+                   )}
+                 </ProfileFormField>
  
-                   <ProfileFormField field="birthdate">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           Birthdate
-                         </label>
-                         <input
-                           type="date"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                         />
-                       </div>
-                     )}
-                   </ProfileFormField>
+                 <ProfileFormField field="birthdate">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         Birthdate
+                       </label>
+                       <input
+                         type="date"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                       />
+                     </div>
+                   )}
+                 </ProfileFormField>
  
-                   <ProfileFormField field="privacyStatus">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           Privacy Status
-                         </label>
-                         <select
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                         >
-                           <option value="PUBLIC">Public</option>
-                           <option value="PRIVATE">Private</option>
-                         </select>
-                       </div>
-                     )}
-                   </ProfileFormField>
-                 </div>
-               </div>
+                 <ProfileFormField field="privacyStatus">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         Privacy Status
+                       </label>
+                       <select
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                       >
+                         <option value="PUBLIC">Public</option>
+                         <option value="PRIVATE">Private</option>
+                       </select>
+                     </div>
+                   )}
+                 </ProfileFormField>
+               </div>
+             </div>
  
-               {/* Professional Information Section */}
-               <div className="bg-white/5 rounded-xl p-6 backdrop-blur-sm mb-6">
-                 <h3 className="text-xl font-semibold text-white mb-4 flex items-center gap-3">
-                   <svg
-                     className="w-6 h-6"
-                     fill="none"
-                     viewBox="0 0 24 24"
-                     stroke="currentColor"
-                   >
-                     <path
-                       strokeLinecap="round"
-                       strokeLinejoin="round"
-                       strokeWidth="2"
-                       d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H8a2 2 0 01-2-2V8a2 2 0 012-2V6"
-                     />
-                   </svg>
-                   Professional Information
-                 </h3>
-                 <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
-                   <ProfileFormField field="company">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           Company
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="Your company name"
-                         />
-                       </div>
-                     )}
-                   </ProfileFormField>
+             {/* Professional Information Section */}
+             <div className="bg-white/5 rounded-xl p-6 backdrop-blur-sm mb-6">
+               <h3 className="text-xl font-semibold text-white mb-4 flex items-center gap-3">
+                 <svg
+                   className="w-6 h-6"
+                   fill="none"
+                   viewBox="0 0 24 24"
+                   stroke="currentColor"
+                 >
+                   <path
+                     strokeLinecap="round"
+                     strokeLinejoin="round"
+                     strokeWidth="2"
+                     d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H8a2 2 0 01-2-2V8a2 2 0 012-2V6"
+                   />
+                 </svg>
+                 Professional Information
+               </h3>
+               <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
+                 <ProfileFormField field="company">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         Company
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="Your company name"
+                       />
+                     </div>
+                   )}
+                 </ProfileFormField>
  
-                   <ProfileFormField field="jobTitle">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           Job Title
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="Your job title"
-                         />
-                       </div>
-                     )}
-                   </ProfileFormField>
-                 </div>
-               </div>
+                 <ProfileFormField field="jobTitle">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         Job Title
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="Your job title"
+                       />
+                     </div>
+                   )}
+                 </ProfileFormField>
+               </div>
+             </div>
  
-               {/* Contact Information Section */}
-               <div className="bg-white/5 rounded-xl p-6 backdrop-blur-sm mb-6">
-                 <h3 className="text-xl font-semibold text-white mb-4 flex items-center gap-3">
-                   <svg
-                     className="w-6 h-6"
-                     fill="none"
-                     viewBox="0 0 24 24"
-                     stroke="currentColor"
-                   >
-                     <path
-                       strokeLinecap="round"
-                       strokeLinejoin="round"
-                       strokeWidth="2"
-                       d="M3 8l7.89 7.89a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
-                     />
-                   </svg>
-                   Contact Information
-                 </h3>
-                 <div className="space-y-4">
-                   <ProfileFormField field="emails">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           Additional Emails
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="email1@example.com, email2@example.com"
-                         />
-                         <p className="text-white/50 text-xs mt-1">
-                           Separate multiple emails with commas
-                         </p>
-                       </div>
-                     )}
-                   </ProfileFormField>
+             {/* Contact Information Section */}
+             <div className="bg-white/5 rounded-xl p-6 backdrop-blur-sm mb-6">
+               <h3 className="text-xl font-semibold text-white mb-4 flex items-center gap-3">
+                 <svg
+                   className="w-6 h-6"
+                   fill="none"
+                   viewBox="0 0 24 24"
+                   stroke="currentColor"
+                 >
+                   <path
+                     strokeLinecap="round"
+                     strokeLinejoin="round"
+                     strokeWidth="2"
+                     d="M3 8l7.89 7.89a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
+                   />
+                 </svg>
+                 Contact Information
+               </h3>
+               <div className="space-y-4">
+                 <ProfileFormField field="emails">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         Additional Emails
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="email1@example.com, email2@example.com"
+                       />
+                       <p className="text-white/50 text-xs mt-1">
+                         Separate multiple emails with commas
+                       </p>
+                     </div>
+                   )}
+                 </ProfileFormField>
  
-                   <ProfileFormField field="phones">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           Phone Numbers
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="+1-555-123-4567, +1-555-987-6543"
-                         />
-                         <p className="text-white/50 text-xs mt-1">
-                           Separate multiple phones with commas
-                         </p>
-                       </div>
-                     )}
-                   </ProfileFormField>
-                 </div>
-               </div>
+                 <ProfileFormField field="phones">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         Phone Numbers
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="+1-555-123-4567, +1-555-987-6543"
+                       />
+                       <p className="text-white/50 text-xs mt-1">
+                         Separate multiple phones with commas
+                       </p>
+                     </div>
+                   )}
+                 </ProfileFormField>
+               </div>
+             </div>
  
-               {/* Address Information Section */}
-               <div className="bg-white/5 rounded-xl p-6 backdrop-blur-sm mb-6">
-                 <h3 className="text-xl font-semibold text-white mb-4 flex items-center gap-3">
-                   <svg
-                     className="w-6 h-6"
-                     fill="none"
-                     viewBox="0 0 24 24"
-                     stroke="currentColor"
-                   >
-                     <path
-                       strokeLinecap="round"
-                       strokeLinejoin="round"
-                       strokeWidth="2"
-                       d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
-                     />
-                     <path
-                       strokeLinecap="round"
-                       strokeLinejoin="round"
-                       strokeWidth="2"
-                       d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
-                     />
-                   </svg>
-                   Address Information
-                 </h3>
-                 <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
-                   <div className="md:col-span-2">
-                     <ProfileFormField field="addressLine">
-                       {({ value, onChange }) => (
-                         <div>
-                           <label className="block text-white/80 text-sm font-medium mb-2">
-                             Street Address
-                           </label>
-                           <input
-                             type="text"
-                             value={value}
-                             onChange={(e) => onChange(e.target.value)}
-                             className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                             placeholder="123 Main Street"
-                           />
-                         </div>
-                       )}
-                     </ProfileFormField>
-                   </div>
+             {/* Address Information Section */}
+             <div className="bg-white/5 rounded-xl p-6 backdrop-blur-sm mb-6">
+               <h3 className="text-xl font-semibold text-white mb-4 flex items-center gap-3">
+                 <svg
+                   className="w-6 h-6"
+                   fill="none"
+                   viewBox="0 0 24 24"
+                   stroke="currentColor"
+                 >
+                   <path
+                     strokeLinecap="round"
+                     strokeLinejoin="round"
+                     strokeWidth="2"
+                     d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
+                   />
+                   <path
+                     strokeLinecap="round"
+                     strokeLinejoin="round"
+                     strokeWidth="2"
+                     d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
+                   />
+                 </svg>
+                 Address Information
+               </h3>
+               <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
+                 <div className="md:col-span-2">
+                   <ProfileFormField field="addressLine">
+                     {({ value, onChange }) => (
+                       <div>
+                         <label className="block text-white/80 text-sm font-medium mb-2">
+                           Street Address
+                         </label>
+                         <input
+                           type="text"
+                           value={value}
+                           onChange={(e) => onChange(e.target.value)}
+                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                           placeholder="123 Main Street"
+                         />
+                       </div>
+                     )}
+                   </ProfileFormField>
+                 </div>
  
-                   <div className="md:col-span-2">
-                     <ProfileFormField field="addressLine2">
-                       {({ value, onChange }) => (
-                         <div>
-                           <label className="block text-white/80 text-sm font-medium mb-2">
-                             Address Line 2
-                           </label>
-                           <input
-                             type="text"
-                             value={value}
-                             onChange={(e) => onChange(e.target.value)}
-                             className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                             placeholder="Apt 4B, Suite 100, etc."
-                           />
-                         </div>
-                       )}
-                     </ProfileFormField>
-                   </div>
+                 <div className="md:col-span-2">
+                   <ProfileFormField field="addressLine2">
+                     {({ value, onChange }) => (
+                       <div>
+                         <label className="block text-white/80 text-sm font-medium mb-2">
+                           Address Line 2
+                         </label>
+                         <input
+                           type="text"
+                           value={value}
+                           onChange={(e) => onChange(e.target.value)}
+                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                           placeholder="Apt 4B, Suite 100, etc."
+                         />
+                       </div>
+                     )}
+                   </ProfileFormField>
+                 </div>
  
-                   <ProfileFormField field="city">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           City
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="New York"
-                         />
-                       </div>
-                     )}
-                   </ProfileFormField>
+                 <ProfileFormField field="city">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         City
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="New York"
+                       />
+                     </div>
+                   )}
+                 </ProfileFormField>
  
-                   <ProfileFormField field="subdivision">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           State/Province
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="NY"
-                         />
-                       </div>
-                     )}
-                   </ProfileFormField>
+                 <ProfileFormField field="subdivision">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         State/Province
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="NY"
+                       />
+                     </div>
+                   )}
+                 </ProfileFormField>
  
-                   <ProfileFormField field="postalCode">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           Postal Code
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="10001"
-                         />
-                       </div>
-                     )}
-                   </ProfileFormField>
+                 <ProfileFormField field="postalCode">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         Postal Code
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="10001"
+                       />
+                     </div>
+                   )}
+                 </ProfileFormField>
  
-                   <ProfileFormField field="country">
-                     {({ value, onChange }) => (
-                       <div>
-                         <label className="block text-white/80 text-sm font-medium mb-2">
-                           Country
-                         </label>
-                         <input
-                           type="text"
-                           value={value}
-                           onChange={(e) => onChange(e.target.value)}
-                           className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
-                           placeholder="US"
-                           maxLength={2}
-                         />
-                         <p className="text-white/50 text-xs mt-1">
-                           2-letter country code (e.g., US, CA, GB)
-                         </p>
-                       </div>
-                     )}
-                   </ProfileFormField>
-                 </div>
-               </div>
+                 <ProfileFormField field="country">
+                   {({ value, onChange }) => (
+                     <div>
+                       <label className="block text-white/80 text-sm font-medium mb-2">
+                         Country
+                       </label>
+                       <input
+                         type="text"
+                         value={value}
+                         onChange={(e) => onChange(e.target.value)}
+                         className="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
+                         placeholder="US"
+                         maxLength={2}
+                       />
+                       <p className="text-white/50 text-xs mt-1">
+                         2-letter country code (e.g., US, CA, GB)
+                       </p>
+                     </div>
+                   )}
+                 </ProfileFormField>
+               </div>
+             </div>
  
-               {/* Update Status */}
-               <ProfileUpdateProgress>
-                 {({ updateState, hasMessage }) => (
-                   <>
-                     {hasMessage && (
-                       <div className="mb-6">
-                         <div className="bg-white/5 rounded-xl p-4">
-                           <div className="flex items-center gap-3">
-                             <div>
-                               {updateState.type === "loading" && (
-                                 <div className="animate-spin w-6 h-6 border-2 border-white/30 border-t-blue-500 rounded-full"></div>
-                               )}
-                               {updateState.type === "success" && (
-                                 <svg
-                                   className="w-6 h-6 text-green-400"
-                                   fill="none"
-                                   viewBox="0 0 24 24"
-                                   stroke="currentColor"
-                                 >
-                                   <path
-                                     strokeLinecap="round"
-                                     strokeLinejoin="round"
-                                     strokeWidth="2"
-                                     d="M5 13l4 4L19 7"
-                                   />
-                                 </svg>
-                               )}
-                               {updateState.type === "error" && (
-                                 <svg
-                                   className="w-6 h-6 text-red-400"
-                                   fill="none"
-                                   viewBox="0 0 24 24"
-                                   stroke="currentColor"
-                                 >
-                                   <path
-                                     strokeLinecap="round"
-                                     strokeLinejoin="round"
-                                     strokeWidth="2"
-                                     d="M6 18L18 6M6 6l12 12"
-                                   />
-                                 </svg>
-                               )}
-                             </div>
-                             <p className="text-white font-medium">
-                               {updateState.message}
-                             </p>
-                           </div>
-                         </div>
-                       </div>
-                     )}
-                   </>
-                 )}
-               </ProfileUpdateProgress>
+             {/* Update Status */}
+             <ProfileUpdateProgress>
+               {({ updateState, hasMessage }) => (
+                 <>
+                   {hasMessage && (
+                     <div className="mb-6">
+                       <div className="bg-white/5 rounded-xl p-4">
+                         <div className="flex items-center gap-3">
+                           <div>
+                             {updateState.type === "loading" && (
+                               <div className="animate-spin w-6 h-6 border-2 border-white/30 border-t-blue-500 rounded-full"></div>
+                             )}
+                             {updateState.type === "success" && (
+                               <svg
+                                 className="w-6 h-6 text-green-400"
+                                 fill="none"
+                                 viewBox="0 0 24 24"
+                                 stroke="currentColor"
+                               >
+                                 <path
+                                   strokeLinecap="round"
+                                   strokeLinejoin="round"
+                                   strokeWidth="2"
+                                   d="M5 13l4 4L19 7"
+                                 />
+                               </svg>
+                             )}
+                             {updateState.type === "error" && (
+                               <svg
+                                 className="w-6 h-6 text-red-400"
+                                 fill="none"
+                                 viewBox="0 0 24 24"
+                                 stroke="currentColor"
+                               >
+                                 <path
+                                   strokeLinecap="round"
+                                   strokeLinejoin="round"
+                                   strokeWidth="2"
+                                   d="M6 18L18 6M6 6l12 12"
+                                 />
+                               </svg>
+                             )}
+                           </div>
+                           <p className="text-white font-medium">
+                             {updateState.message}
+                           </p>
+                         </div>
+                       </div>
+                     </div>
+                   )}
+                 </>
+               )}
+             </ProfileUpdateProgress>
  
-               {/* Form Actions */}
-               <ProfileUpdateTrigger>
-                 {({ updateProfile, canUpdate, isUpdating }) => (
-                   <div className="flex gap-4 pt-4">
-                     <button
-                       onClick={updateProfile}
-                       disabled={!canUpdate}
-                       className="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 disabled:from-gray-500 disabled:to-gray-600 disabled:cursor-not-allowed text-white font-semibold py-4 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-xl disabled:hover:scale-100 disabled:hover:shadow-none"
-                     >
-                       <span className="flex items-center justify-center gap-3">
-                         <svg
-                           className="w-5 h-5"
-                           fill="none"
-                           viewBox="0 0 24 24"
-                           stroke="currentColor"
-                         >
-                           <path
-                             strokeLinecap="round"
-                             strokeLinejoin="round"
-                             strokeWidth="2"
-                             d="M5 13l4 4L19 7"
-                           />
-                         </svg>
-                         {isUpdating ? "Updating..." : "Update Profile"}
-                       </span>
-                     </button>
-                     <button
-                       type="button"
-                       onClick={onClose}
-                       className="px-8 py-4 bg-white/10 hover:bg-white/20 text-white font-semibold rounded-xl transition-all duration-200"
-                     >
-                       Cancel
-                     </button>
-                   </div>
-                 )}
-               </ProfileUpdateTrigger>
-             </div>
-           </div>
-         </div>
-       </div>
-     </ServicesManagerProvider>
+             {/* Form Actions */}
+             <ProfileUpdateTrigger>
+               {({ updateProfile, canUpdate, isUpdating }) => (
+                 <div className="flex gap-4 pt-4">
+                   <button
+                     onClick={updateProfile}
+                     disabled={!canUpdate}
+                     className="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 disabled:from-gray-500 disabled:to-gray-600 disabled:cursor-not-allowed text-white font-semibold py-4 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-xl disabled:hover:scale-100 disabled:hover:shadow-none"
+                   >
+                     <span className="flex items-center justify-center gap-3">
+                       <svg
+                         className="w-5 h-5"
+                         fill="none"
+                         viewBox="0 0 24 24"
+                         stroke="currentColor"
+                       >
+                         <path
+                           strokeLinecap="round"
+                           strokeLinejoin="round"
+                           strokeWidth="2"
+                           d="M5 13l4 4L19 7"
+                         />
+                       </svg>
+                       {isUpdating ? "Updating..." : "Update Profile"}
+                     </span>
+                   </button>
+                   <button
+                     type="button"
+                     onClick={onClose}
+                     className="px-8 py-4 bg-white/10 hover:bg-white/20 text-white font-semibold rounded-xl transition-all duration-200"
+                   >
+                     Cancel
+                   </button>
+                 </div>
+               )}
+             </ProfileUpdateTrigger>
+           </div>
+         </div>
+       </div>
+     </div>
    );
  }
```

---

Finally, let me update the documentation to mention this important rule about dependent services needing to be in the same ServicesManager:

---

```diff
  
  This way, when the profile is updated, the current member state is immediately updated on the client side, and any UI components using the CurrentMember headless components will reactively update.
+ 
+ ### Critical Rule: Same ServicesManager for Dependent Services
+ 
+ **IMPORTANT**: Services that depend on each other MUST be registered in the same `ServicesManager` to share state properly.
+ 
+ If you have a service that depends on another service (using `getService`), both services must be added to the same `ServicesMap` when creating the `ServicesManager`:
+ 
+ ```tsx
+ // ✅ CORRECT: Both services in the same ServicesManager
+ const servicesManager = createServicesManager(
+   createServicesMap()
+     .addService(CurrentMemberServiceDefinition, CurrentMemberService, currentMemberConfig)
+     .addService(ProfileUpdateServiceDefinition, ProfileUpdateService, profileUpdateConfig)
+ );
+ 
+ <ServicesManagerProvider servicesManager={servicesManager}>
+   {/* Both CurrentMember and ProfileUpdate headless components work here */}
+   <UpdateProfileDialog />
+ </ServicesManagerProvider>
+ ```
+ 
+ ```tsx
+ // ❌ WRONG: Services in different ServicesManagers
+ <ServicesManagerProvider servicesManager={currentMemberServicesManager}>
+   <ProfileSection />
+   
+   <ServicesManagerProvider servicesManager={profileUpdateServicesManager}>
+     {/* ProfileUpdate service cannot access CurrentMember service from parent */}
+     <UpdateProfileDialog />
+   </ServicesManagerProvider>
+ </ServicesManagerProvider>
+ ```
+ 
+ **Why this matters:**
+ - Each `ServicesManager` creates its own isolated service container
+ - Services can only access other services within the same container via `getService`
+ - State is not shared between different `ServicesManager` instances
+ - Dependent services in different managers will fail at runtime when trying to call `getService`
```

---

Perfect! I've successfully implemented all the requested changes:

## Summary of Changes Made

### 1. **Updated Members Page (`src/react-pages/members/index.tsx`)**
- Added imports for `ProfileUpdateServiceDefinition` and `ProfileUpdateService`
- Added `profileUpdateServiceConfig` to the props interface
- Modified the `ServicesManager` creation to include both `CurrentMemberService` and `ProfileUpdateService` in the same services map
- Both services now share the same service container and can access each other's state

### 2. **Updated Astro Page (`src/pages/members/index.astro`)**
- Added import for `loadProfileUpdateServiceConfig`
- Added loading of profile update service config alongside the current member service config
- Fixed TypeScript error by ensuring `member._id` exists before calling the config loader
- Passed the `profileUpdateServiceConfig` to the React component

### 3. **Refactored UpdateProfileDialog (`src/components/UpdateProfileDialog.tsx`)**
- **Removed** all service-related imports (`createServicesManager`, `ServicesManagerProvider`, etc.)
- **Removed** the internal `ServicesManagerProvider` wrapper
- The dialog now relies on the services being provided by the parent `ServicesManagerProvider` from the members page
- Simplified the component to focus purely on UI rendering

### 4. **Updated Documentation (`.cursor/rules/client-side-services-and-headless-components.mdc`)**
- Added a comprehensive "Service Dependencies" section explaining how services can depend on each other
- Added detailed examples of proper vs improper service dependency usage
- **Added a critical rule** highlighting that dependent services MUST be in the same `ServicesManager`
- Explained the technical reasons why this rule is important (isolated service containers, state sharing, runtime failures)

## Key Benefits Achieved

1. **Proper State Sharing**: The `ProfileUpdateService` now properly depends on `CurrentMemberService` and updates client-side state immediately
2. **Consistent Architecture**: Services are properly centralized at the page level rather than scattered in individual components
3. **Better Performance**: Single service container reduces overhead and ensures efficient state management
4. **Clear Documentation**: The rule about same ServicesManager for dependent services is now clearly documented to prevent future issues

The profile update functionality will now immediately reflect changes in the current member state across all UI components, providing a much more responsive and consistent user experience.

---

_**User**_

now let's change the profile update to get the intial data from the current member services instead of in a config, and no longer really neeads the memeber id

---

_**Assistant**_



---

I'll help you refactor the profile update service to get the initial data from the current member service instead of relying on config. This makes perfect sense since the services are now dependent and can share state.

---

```diff
    defineService<ProfileUpdateServiceAPI>("profileUpdate");
  
- export const ProfileUpdateService = implementService.withConfig<{
-   memberId: string;
-   initialData?: Partial<ProfileFormData>;
- }>()(ProfileUpdateServiceDefinition, ({ getService, config }) => {
+ export const ProfileUpdateService = implementService.withConfig<{}>()(ProfileUpdateServiceDefinition, ({ getService, config }) => {
    const signalsService = getService(SignalsServiceDefinition);
    const currentMemberService = getService(CurrentMemberServiceDefinition);
+ 
+   // Get current member data from the service
+   const currentMember = currentMemberService.currentMember.get();
+ 
+   // Extract initial data from current member
+   const initialData: Partial<ProfileFormData> = {};
+   
+   if (currentMember) {
+     // Map member data to form data
+     if (currentMember.contact) {
+       if (currentMember.contact.firstName)
+         initialData.firstName = currentMember.contact.firstName;
+       if (currentMember.contact.lastName)
+         initialData.lastName = currentMember.contact.lastName;
+       if (currentMember.contact.birthdate)
+         initialData.birthdate = currentMember.contact.birthdate;
+       if (currentMember.contact.company) initialData.company = currentMember.contact.company;
+       if (currentMember.contact.jobTitle)
+         initialData.jobTitle = currentMember.contact.jobTitle;
+       if (currentMember.contact.emails?.length)
+         initialData.emails = currentMember.contact.emails.join(", ");
+       if (currentMember.contact.phones?.length)
+         initialData.phones = currentMember.contact.phones.join(", ");
+ 
+       if (currentMember.contact.addresses?.[0]) {
+         const address = currentMember.contact.addresses[0];
+         if (address.addressLine) initialData.addressLine = address.addressLine;
+         if (address.addressLine2)
+           initialData.addressLine2 = address.addressLine2;
+         if (address.city) initialData.city = address.city;
+         if (address.subdivision) initialData.subdivision = address.subdivision;
+         if (address.postalCode) initialData.postalCode = address.postalCode;
+         if (address.country) initialData.country = address.country;
+       }
+     }
+ 
+     if (currentMember.profile) {
+       if (currentMember.profile.nickname)
+         initialData.nickname = currentMember.profile.nickname;
+       if (currentMember.profile.title) initialData.profileTitle = currentMember.profile.title;
+     }
+ 
+     if (currentMember.privacyStatus) initialData.privacyStatus = currentMember.privacyStatus;
+   }
  
    const defaultFormData: ProfileFormData = {
```

```diff
      postalCode: "",
      country: "",
-     ...config.initialData,
+     ...initialData,
    };
  
```

```diff
  });
  
- export async function loadProfileUpdateServiceConfig(
-   memberId: string,
-   member?: any
- ): Promise<ServiceFactoryConfig<typeof ProfileUpdateService>> {
-   const initialData: Partial<ProfileFormData> = {};
- 
-   if (member) {
-     // Map member data to form data
-     if (member.contact) {
-       if (member.contact.firstName)
-         initialData.firstName = member.contact.firstName;
-       if (member.contact.lastName)
-         initialData.lastName = member.contact.lastName;
-       if (member.contact.birthdate)
-         initialData.birthdate = member.contact.birthdate;
-       if (member.contact.company) initialData.company = member.contact.company;
-       if (member.contact.jobTitle)
-         initialData.jobTitle = member.contact.jobTitle;
-       if (member.contact.emails?.length)
-         initialData.emails = member.contact.emails.join(", ");
-       if (member.contact.phones?.length)
-         initialData.phones = member.contact.phones.join(", ");
- 
-       if (member.contact.addresses?.[0]) {
-         const address = member.contact.addresses[0];
-         if (address.addressLine) initialData.addressLine = address.addressLine;
-         if (address.addressLine2)
-           initialData.addressLine2 = address.addressLine2;
-         if (address.city) initialData.city = address.city;
-         if (address.subdivision) initialData.subdivision = address.subdivision;
-         if (address.postalCode) initialData.postalCode = address.postalCode;
-         if (address.country) initialData.country = address.country;
-       }
-     }
- 
-     if (member.profile) {
-       if (member.profile.nickname)
-         initialData.nickname = member.profile.nickname;
-       if (member.profile.title) initialData.profileTitle = member.profile.title;
-     }
- 
-     if (member.privacyStatus) initialData.privacyStatus = member.privacyStatus;
-   }
- 
-   return {
-     memberId,
-     initialData,
-   };
+ export async function loadProfileUpdateServiceConfig(): Promise<ServiceFactoryConfig<typeof ProfileUpdateService>> {
+   return {};
  }
  
```

---

Now I need to update the Astro page to not pass member data to the config loader:

---

```diff
    if (member && member._id) {
      currentMemberServiceConfig = await loadCurrentMemberServiceConfig();
-     profileUpdateServiceConfig = await loadProfileUpdateServiceConfig(
-       member._id,
-       member
-     );
+     profileUpdateServiceConfig = await loadProfileUpdateServiceConfig();
    }
  }
```

---

Perfect! Now let me also update the members page to ensure it handles the case where `profileUpdateServiceConfig` might be undefined (though it should always be an empty object now):

---

```diff
          ProfileUpdateServiceDefinition,
          ProfileUpdateService,
-         profileUpdateServiceConfig
+         profileUpdateServiceConfig || {}
        )
    );
```

---

Now let me update the documentation to reflect this change in the service dependency pattern:

---

```diff
  // ProfileUpdateService depends on CurrentMemberService
  const currentMemberService = getService(CurrentMemberServiceDefinition);
+ 
+ // Get initial data from the current member service instead of config
+ const currentMember = currentMemberService.currentMember.get();
+ const initialData = extractFormDataFromMember(currentMember);
  
  const updateProfile = async () => {
```

```diff
  ```
  
- This way, when the profile is updated, the current member state is immediately updated on the client side, and any UI components using the CurrentMember headless components will reactively update.
+ This pattern shows how dependent services can:
+ 1. **Share data**: ProfileUpdate gets its initial form data from CurrentMember's state
+ 2. **Share operations**: ProfileUpdate uses CurrentMember's updateMember method
+ 3. **Maintain consistency**: Updates through one service immediately reflect in the other
+ 
+ When the profile is updated, the current member state is immediately updated on the client side, and any UI components using the CurrentMember headless components will reactively update.
  
  ### Critical Rule: Same ServicesManager for Dependent Services
```

---

Perfect! I've successfully refactored the profile update service to get its initial data from the current member service instead of relying on config. Here's a summary of the changes made:

## Summary of Changes

### 1. **Updated ProfileUpdateService (`src/headless/members/profile-update-service.ts`)**
- **Removed config requirements**: Changed the config interface from `{ memberId: string; initialData?: Partial<ProfileFormData>; }` to `{}`
- **Added direct data access**: The service now gets the current member data directly from `currentMemberService.currentMember.get()`
- **Moved data mapping logic**: The logic to extract initial form data from member data is now inside the service implementation instead of the config loader
- **Simplified config loader**: `loadProfileUpdateServiceConfig()` now just returns an empty object since no config is needed

### 2. **Updated Astro Page (`src/pages/members/index.astro`)**
- **Simplified config loading**: Removed the `member._id` and `member` parameters from `loadProfileUpdateServiceConfig()` call
- The config loader no longer needs member data since the service gets it directly

### 3. **Updated Members Page (`src/react-pages/members/index.tsx`)**
- **Added fallback**: Added `|| {}` fallback for `profileUpdateServiceConfig` to ensure it's never undefined

### 4. **Updated Documentation**
- **Enhanced example**: Updated the service dependency example to show how ProfileUpdate gets initial data from CurrentMember service
- **Added benefits list**: Clarified the three main benefits of this pattern (share data, share operations, maintain consistency)

## Key Benefits of This Refactor

### 1. **Simplified Architecture**
- No more complex config passing between services
- The ProfileUpdateService is now truly self-contained and gets all its data from its dependencies

### 2. **Better State Consistency**
- Initial form data always reflects the current state of the member in the CurrentMemberService
- No risk of stale data being passed through config

### 3. **Reduced Coupling**
- The Astro page and React components no longer need to know about the internal data needs of ProfileUpdateService
- Service dependencies are handled entirely within the service layer

### 4. **Cleaner Service Dependencies**
- Clear demonstration of how dependent services can share both data and operations
- ProfileUpdateService is now a pure consumer of CurrentMemberService's state and methods

This refactor makes the service architecture much cleaner and demonstrates a proper dependency pattern where services can share state and operations seamlessly while maintaining clear separation of concerns.

---

