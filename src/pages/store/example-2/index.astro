---
import { loadCategoriesConfig } from "../../../headless/store/services/category-service";

// Redirect to the first category (typically "All Products") for consistent URL structure
const categoriesConfig = await loadCategoriesConfig();
const firstCategory = categoriesConfig.categories[0];

if (!firstCategory) {
  throw new Error("No categories found");
}

// Generate slug from category name if no slug exists
const generateSlug = (name: string) => 
  name.toLowerCase()
    .replace(/[^a-z0-9\s-]/g, '')
    .replace(/\s+/g, '-')
    .replace(/-+/g, '-')
    .trim();

const categorySlug = firstCategory.slug || generateSlug(firstCategory.name || 'all-products');
const redirectUrl = `/store/example-2/category/${categorySlug}${Astro.url.search}`;

return Astro.redirect(redirectUrl);
---
