---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { isLoggedIn } from "@wix/astro/auth";
import { members } from "@wix/members";
import { MembersPage } from "../../react-pages/members/index";

// Server-side logic
const userIsLoggedIn = isLoggedIn();
let member;
if (userIsLoggedIn) {
  member = (
    await members.getCurrentMember({
      fieldsets: ["FULL"],
    })
  ).member;
}

// Handle URL parameters for success/error messages
const url = new URL(Astro.request.url);
const updated = url.searchParams.get("updated");
const error = url.searchParams.get("error");
---

<BaseLayout>
  <title>Members - Wix Kitchensink</title>
  <meta
    name="description"
    content="Member authentication, profile management, and member data handling with Wix Members"
  />

  <MembersPage
    client:load
    userIsLoggedIn={userIsLoggedIn}
    member={member}
    updated={updated}
    error={error}
    slot="body"
  />
</BaseLayout>
